import { useState } from 'react';
import { Combobox } from '../src';
import { Affix } from '../../_helpers';

# Combobox

A combobox (also known as an autocomplete or autosuggest) component.

A combobox is the combination of an `<input type="text"/>` and a list. The list
is designed to help the user arrive at a value, but the value does not
necessarily have to come from that list. Don't think of it like a `<select/>`,
but more of an input with some suggestions. You can, however, validate that the
value comes from the list, that's up to your app.

## Import

```js
import { Combobox } from '@fabric-ds/react';
```

## Example

```jsx example
function Example() {
  const [value, setValue] = useState('');

  return (
    <Combobox
      label="Choose a fruit"
      value={value}
      onChange={(val) => setValue(val)}
      onSelect={(val) => setValue(val)}
      options={[
        { value: 'Apple' },
        { value: 'Banana' },
        { value: 'Orange' },
        { value: 'Pineapple' },
      ]}
    />
  );
}
```

## Migrating from Troika

- You should no longer include or import any Troika React's combobox CSS.

### Highlight matched text segments

If you want to highlight the matched text you can set the `matchTextSegments`
prop.

```jsx example
function Example() {
  const [value, setValue] = useState('');

  return (
    <Combobox
      label="Choose a fruit"
      value={value}
      onChange={(val) => setValue(val)}
      onSelect={(val) => setValue(val)}
      matchTextSegments
      options={[
        { value: 'Apple' },
        { value: 'Banana' },
        { value: 'Orange' },
        { value: 'Pineapple' },
      ]}
    />
  );
}
```

Note that this prop only enables the component's default styling for text
matches. You can style text matches however you'd like by overriding styles on
`[data-combobox-text-match]`. For example:

```css example
[data-combobox-text-match] {
  background: yellow;
}
```

The `matchTextSegments` uses the default algorithm for input/option matching. To
write your own matching algorithm, pass a function to the `highlightValueMatch`
prop. In most cases you won't have to alter this.

Example

```tsx
// PSEUDO CODE
function highlightValueMatch(optionValue: string, inputValue: string) {
    // ADDITIONAL CODE?
    if match // return JSX string value with additional visual styling
    else // return JSX string value
  });
}
```

## Asynchronous option fetching

When you fetch options asynchronously, it is often preferred to pass the
`disableStaticFiltering` prop so that you don't filter the options client side.

## Custom rendering in ComboboxOption

Sometimes you need to render something other than the value as the visible
option, in these cases you can pass a `label`. The label is only for display.
The `value` is what gets sent back when selected.

```jsx example
function Example() {
  const [value, setValue] = useState('');

  return (
    <Combobox
      label="Choose a fruit"
      placeholder="Custom Option Rendering"
      value={value}
      onChange={(val) => setValue(val)}
      onSelect={(val) => setValue(val)}
      matchTextSegments
      options={[
        { value: 'Apple', label: '🍎 Apple' },
        { value: 'Banana', label: '🍌 Banana' },
        { value: 'Orange', label: '🍊 Orange' },
        { value: 'Pineapple', label: '🍍 Pineapple' },
      ]}
    />
  );
}
```

## Client side search

This example searches an API of Star Wars characters. Combobox does not
implement any matching on your list (aside from highlighting the matched phrases
in an option). Instead, you render an option for each result you want in the
list. So your job is to:

- Establish the search term state
- Match the search to your list
- Render an option for each match

There is nothing special about managing state for a combobox, it's like managing
state for any other list in your app. As the input changes, you figure out what
state you need, then render as many options as you want.

```jsx example
function Example() {
  const [value, setValue] = React.useState('');
  const characters = useDebouncedSearch(value, 300);

  // Generic debouncer
  function useDebouncedSearch(query, delay) {
    const [characters, setCharacters] = React.useState([]);

    React.useEffect(() => {
      if (!query.length) setCharacters([]);

      const handler = setTimeout(() => {
        fetch('https://swapi.dev/api/people/?search=' + query.trim())
          .then((res) => res.json())
          .then((res) => {
            console.log('Results from API', query);
            setCharacters(res.results.map((c) => ({ value: c.name })));
          });
      }, delay);

      return () => {
        clearTimeout(handler);
      };
    }, [query]);

    return characters;
  }

  return (
    <Combobox
      label="Star Wars character"
      disableStaticFiltering
      matchTextSegments
      openOnFocus
      value={value}
      onChange={(val) => {
        setValue(val);
      }}
      onSelect={(val) => {
        setValue(val);
        action('select')(val);
      }}
      options={characters}
    >
      <Affix
        suffix
        clear
        aria-label="Clear text"
        onClick={() => {
          setValue('');
        }}
      />
    </Combobox>
  );
}
```

### Affix

If you wish to use an affix you must first import the Affix component.

```js
import { Affix } from '@fabric-ds/react';
```

Then you include it as a child of Combobox component and pass the appropiate
props (see bottom of this page for types)

```jsx example
function Example() {
  const [value, setValue] = useState('');

  return (
    <Combobox
      label="Choose a fruit"
      placeholder="Your favorite fruit"
      value={value}
      onChange={(val) => setValue(val)}
      onSelect={(val) => setValue(val)}
      matchTextSegments
      options={[
        { value: 'Apple', label: '🍎 Apple' },
        { value: 'Banana', label: '🍌 Banana' },
        { value: 'Orange', label: '🍊 Orange' },
        { value: 'Pineapple', label: '🍍 Pineapple' },
      ]}
    >
      <Affix
        suffix
        clear
        aria-label="Clear text"
        onClick={() => setValue('')}
      />
    </Combobox>
  );
}
```

**Note** that when using the Affix component without a `label` you should
specify an `aria-label`. See props at the bottom of this page. See
[TextField](/textfield#affix) for more details on Affix.

### Clearing input on select

If you want, you can have the input field cleared after a value has been
selected:

```jsx example
function Example() {
  const [value, setValue] = useState('');

  return (
    <Combobox
      label="Choose a fruit"
      value={value}
      onChange={(val) => setValue(val)}
      onSelect={(val) => {
        alert(val);
        setValue('');
      }}
      options={[
        { value: 'Apple' },
        { value: 'Banana' },
        { value: 'Orange' },
        { value: 'Pineapple' },
      ]}
    />
  );
}
```

### Optional prop

Add the optional prop to indicate that the combobox field is not required.

```jsx example
function Example() {
  const [value, setValue] = useState('');

  return (
    <Combobox
      label="Choose a fruit"
      optional
      value={value}
      onChange={(val) => setValue(val)}
      onSelect={(val) => {
        alert(val);
        setValue('');
      }}
      options={[
        { value: 'Apple' },
        { value: 'Banana' },
        { value: 'Orange' },
        { value: 'Pineapple' },
      ]}
    />
  );
}
```

### Providing feedback

You can provide feedback to the user via the feedback prop. This is especially useful when performing asynchronous operations such as fetching options from an API as it enables you to tell the user that they need to wait for search results or that no results were found and so on.

```ts
<Combobox
  ...
  feedback="Søker..."
  ...
/>
```

When feedback is set to a non empty string, options will not show. Omit feedback entirely or set it to an empty string when not in use.

## Combobox Props

```props packages/combobox/src/component.tsx

```

```ts
export type ComboboxOption = {
  value: string;
  label?: string;
};
```

## Affix Props

```props packages/_helpers/affix.tsx

```
